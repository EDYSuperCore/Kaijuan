# 开卷（Kaijuan — Archive Unfolder）
![icon](https://tu.yameidie.com:808/i/2026/02/01/235305.png)

开卷是一个图包自动展开工具，用于扫描目录中的压缩包（如 zip / cbz），并批量解压整理，适合漫画、写真等内容管理场景。

## 项目简介

开卷可以帮助你：
- 📦 **批量解压**：自动扫描目录，批量处理压缩包
- 🔐 **密码支持**：支持加密压缩包，可配置常用密码列表或手动输入
- ⚙️ **灵活配置**：支持多种冲突处理策略（跳过、覆盖、重命名）
- 📊 **任务管理**：实时查看任务状态、进度和日志
- 🎨 **现代界面**：卡片式任务列表，支持暗黑模式

## 功能特性

### 核心功能
- ✅ **目录扫描**：递归扫描指定目录，查找 .zip 和 .cbz 文件
- ✅ **批量解压**：创建解压任务，支持批量处理多个压缩包
- ✅ **异步执行**：后台异步解压，不阻塞界面操作
- ✅ **状态跟踪**：实时查看任务状态（等待中/运行中/成功/失败）
- ✅ **日志查看**：支持查看每个任务的详细执行日志

### 高级功能
- ✅ **密码管理**：支持常用密码列表、手动输入、自动尝试多种密码
- ✅ **冲突策略**：支持跳过（skip）、覆盖（overwrite）、重命名（rename）三种处理方式
- ✅ **任务列表美化**：卡片式设计，状态标签，动态进度条
- ✅ **暗黑模式**：支持系统级暗黑模式，可手动切换
- ✅ **配置弹窗**：优化界面布局，配置选项集中在弹窗中

## 使用场景

- **漫画管理**：批量解压下载的漫画压缩包，整理到统一目录
- **写真整理**：自动展开图片压缩包，便于浏览和管理
- **文件归档**：批量处理历史压缩包，释放存储空间
- **内容分发**：快速展开大量压缩包，准备内容分发

## 快速开始

### Docker 部署（推荐）

使用 Docker Compose 一键启动：

```bash
# 启动服务
docker-compose up -d

# 查看日志
docker-compose logs -f kaijuan

# 停止服务
docker-compose down
```

启动后访问：http://localhost:30080

### 本地开发

1. **安装依赖**
   ```bash
   cd app/server
   npm install
   ```

2. **运行服务**
   ```bash
   npm run dev
   ```

3. **访问界面**
   
   打开浏览器访问：http://127.0.0.1:30080

## 使用说明

### 基本流程

1. **扫描目录**：在首页选择要扫描的目录，点击"扫描"按钮
2. **选择文件**：从扫描结果中选择要解压的压缩包
3. **配置选项**：点击"创建任务"，在弹出的配置窗口中设置：
   - 解压密码（如需要）
   - 冲突处理策略（跳过/覆盖/重命名）
4. **开始解压**：点击"确认开始"，任务将自动执行
5. **查看结果**：在任务列表中查看任务状态和日志

### 密码功能

开卷支持解压加密压缩包，提供四种密码策略：

1. **不使用密码**：适用于未加密的压缩包
2. **从常用密码选择**：从设置中维护的常用密码列表中选择一个
3. **本次手动输入**：为当前任务临时输入一个密码
4. **挨个尝试常用密码**：按顺序尝试常用密码列表，直到成功或全部失败

**配置常用密码**：
- 前往"设置"页面（点击右上角设置图标）
- 在"常用密码"区域添加、删除或调整密码顺序
- 密码默认遮盖显示，点击可显示/隐藏

### 冲突处理策略

当解压目标目录已存在时，可以选择以下处理方式：

- **跳过（skip）**：如果目标目录已存在，跳过该文件
- **覆盖（overwrite）**：如果目标目录已存在，直接覆盖
- **重命名（rename）**：如果目标目录已存在，自动重命名新文件

### 输出方式

压缩包会解压到同级的同名目录（去掉扩展名）：
- 例如：`/path/to/file.zip` → `/path/to/file/`

## 系统要求

- **操作系统**：Linux / WSL（Windows 不再支持）
- **Node.js**：>= 14.0.0（推荐 20.x）
- **7z 工具**：系统需安装 7-Zip 命令行工具，或使用 Docker 部署（已内置）

## Docker 部署详情

### 挂载目录

如果你想扫描宿主机上的文件，需要在 `docker-compose.yml` 的 `volumes` 部分添加目录映射：

```yaml
volumes:
  - ./data:/app/data                    # 数据目录（必需）
  - /home/user/comics:/mnt/comics       # 你的媒体目录
  - /mnt/d/downloads:/mnt/downloads     # 其他目录
```

### 构建和推送镜像

项目提供了自动化脚本用于构建和推送 Docker 镜像：

```bash
# 设置 Docker Hub 用户名
export DOCKER_USERNAME=your-username

# 运行构建和推送脚本
./docker-build-push.sh
```

详细使用说明请参考 [DOCKER_BUILD_README.md](./DOCKER_BUILD_README.md)。

## 当前限制

- ✅ 支持 `.zip` 和 `.cbz` 格式（扫描功能默认只包含这两种格式）
- ✅ 支持加密压缩包（zip/7z/rar 等，需提供密码）
- ⚠️ 暂不支持 `.7z`、`.rar` 等格式的扫描和批量处理（虽然 7z 工具本身支持这些格式，但扫描功能目前只包含 `.zip` 和 `.cbz`）
- ⚠️ 暂不支持分卷压缩

## 开发计划

- [x] 支持密码保护
- [x] 实现冲突处理策略（skip/overwrite/rename）
- [x] 任务列表美化
- [x] 暗黑模式支持
- [x] 日志查看功能
- [ ] 支持 RAR、7Z 格式（未加密）
- [ ] 支持分卷压缩
- [ ] 支持任务取消
- [ ] 优化大目录扫描性能

## 技术栈

- **后端**：Node.js + TypeScript + Fastify
- **前端**：原生 HTML/CSS/JavaScript（单页应用）
- **数据库**：SQLite
- **解压工具**：7-Zip (7z)

## 许可证

MIT
